<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Utility Functions</title>

    <script>
        // Function to calculate net salary
        function calculateNetSalary() {
            try {
                let basicSalary = parseFloat(document.getElementById('basicSalary').value);
                let benefits = parseFloat(document.getElementById('benefits').value);

                if (isNaN(basicSalary) || isNaN(benefits) || basicSalary < 0 || benefits < 0) {
                    alert("Invalid input. Salary values should be positive numbers.");
                    return;
                }

                // Calculate Gross Salary
                const grossSalary = basicSalary + benefits;

                // Calculate PAYE (Tax)
                const taxableIncome = grossSalary - 2400; // Considering Personal Relief of 2400
                const paye = calculatePAYE(taxableIncome);

                // Calculate NHIF Deductions
                const nhifDeductions = calculateNHIF(grossSalary);

                // Calculate NSSF Deductions (Assuming 6% each from employer and employee)
                const nssfDeductions = calculateNSSF(basicSalary);

                // Calculate Net Salary
                const netSalary = grossSalary - paye - nhifDeductions - nssfDeductions;

                // Display results
                document.getElementById('netSalaryOutput').innerHTML = `<strong>Net Salary:</strong> ${netSalary.toFixed(2)} Ksh`;

            } catch (error) {
                console.log(error.message); // Output the error message if any unexpected error occurs
            }
        }

        // Function to calculate PAYE (Tax) based on Kenya's PAYE rates
        function calculatePAYE(taxableIncome) {
            let tax = 0;

            if (taxableIncome <= 24000) {
                tax = taxableIncome * 0.1;
            } else if (taxableIncome <= 32333) {
                tax = 2400 + (taxableIncome - 24000) * 0.25;
            } else if (taxableIncome <= 500000) {
                tax = 5933 + (taxableIncome - 32333) * 0.3;
            } else if (taxableIncome <= 800000) {
                tax = 109333 + (taxableIncome - 500000) * 0.325;
            } else {
                tax = 203333 + (taxableIncome - 800000) * 0.35;
            }

            return tax;
        }

        // Function to calculate NHIF Deductions based on gross pay
        function calculateNHIF(grossPay) {
            // NHIF Deduction rates based on income ranges
            const nhifRates = [
                { min: 0, max: 5999, deduction: 150 },
                { min: 6000, max: 7999, deduction: 300 },
                { min: 8000, max: 11999, deduction: 400 },
                { min: 12000, max: 14999, deduction: 500 },
                { min: 15000, max: 19999, deduction: 600 },
                { min: 20000, max: 24999, deduction: 750 },
                { min: 25000, max: 29999, deduction: 850 },
                { min: 30000, max: 34999, deduction: 900 },
                { min: 35000, max: 39999, deduction: 950 },
                { min: 40000, max: 44999, deduction: 1000 },
                { min: 45000, max: 49999, deduction: 1100 },
                { min: 50000, max: 59999, deduction: 1200 },
                { min: 60000, max: 69999, deduction: 1300 },
                { min: 70000, max: 79999, deduction: 1400 },
                { min: 80000, max: 89999, deduction: 1500 },
                { min: 90000, max: 99999, deduction: 1600 },
                { min: 100000, max: Infinity, deduction: 1700 }
            ];

            // Find the appropriate NHIF deduction based on grossPay
            for (let i = 0; i < nhifRates.length; i++) {
                if (grossPay >= nhifRates[i].min && grossPay <= nhifRates[i].max) {
                    return nhifRates[i].deduction;
                }
            }

            return 0; // Default to 0 if no matching range found
        }

        // Function to calculate NSSF Deductions based on pensionable pay
        function calculateNSSF(pensionablePay) {
            const tier1LimitFeb2024 = 7000;
            const tier2LimitFeb2024 = 36000;
            let nssf = 0;

            if (pensionablePay <= tier1LimitFeb2024) {
                nssf = pensionablePay * 0.06;
            } else if (pensionablePay <= tier2LimitFeb2024) {
                nssf = tier1LimitFeb2024 * 0.06 + (pensionablePay - tier1LimitFeb2024) * 0.06;
            } else {
                nssf = tier1LimitFeb2024 * 0.06 + (tier2LimitFeb2024 - tier1LimitFeb2024) * 0.06;
            }

            return nssf;
        }

        // Function to check speed against a limit
        function checkSpeed() {
            try {
                let speed = parseFloat(document.getElementById('speed').value);
                const speedLimit = 70;  // Define the speed limit in km/h
                let demeritPoints = 0;  // Initialize demerit points to zero

                if (isNaN(speed) || speed < 0) {
                    alert("Invalid input. Speed should be a positive number.");
                    return;
                }

                if (speed <= speedLimit) {
                    alert("Ok");  // Speed is within the limit
                } else {
                    demeritPoints = Math.floor((speed - speedLimit) / 5);  // Calculate demerit points
                    alert(`Points: ${demeritPoints}`);  // Output demerit points

                    if (demeritPoints > 12) {
                        alert("License suspended");  // Output if demerit points exceed 12
                    }
                }
            } catch (error) {
                console.log(error.message); // Output the error message if any unexpected error occurs
            }
        }

        // Function to generate grade based on marks
        function generateGrade() {
            try {
                let marks = parseFloat(prompt("Enter the student's marks (0-100):"));
                if (marks === null || isNaN(marks) || marks < 0 || marks > 100) {
                    alert("Invalid input. Marks should be between 0 and 100.");
                    return;
                }

                let grade;
                if (marks > 79) {
                    grade = 'A';
                } else if (marks >= 60) {
                    grade = 'B';
                } else if (marks >= 50) {
                    grade = 'C';
                } else if (marks >= 40) {
                    grade = 'D';
                } else {
                    grade = 'E';
                }

                alert(`Grade: ${grade}`);

            } catch (error) {
                console.log(error.message); // Output the error message if any unexpected error occurs
            }
        }
    </script>
</head>
<body>
    <h2>Utility Functions</h2>

    <!-- Net Salary Calculator Section -->
    <h3>Net Salary Calculator</h3>
    <p>Enter Basic Salary (Ksh): <input type="number" id="basicSalary" min="0"></p>
    <p>Enter Benefits (Ksh): <input type="number" id="benefits" min="0"></p>
    <button onclick="calculateNetSalary()">Calculate Net Salary</button>
    <p id="netSalaryOutput"></p>

    <!-- Speed Detector Section -->
    <h3>Speed Detector</h3>
    <p>Enter Speed (km/h): <input type="number" id="speed" min="0"></p>
    <button onclick="checkSpeed()">Check Speed</button>

    <!-- Student Grade Generator Section -->
    <h3>Student Grade Generator</h3>
    <button onclick="generateGrade()">Generate Grade</button>

</body>
</html>
